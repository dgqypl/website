---
sidebar_position: 2
---

# 使用方法

## 负载均衡工作原理

负载均衡的功能由负载均衡集群实现，负载均衡集群由多个负载均衡节点组成，每个节点是一台运行负载均衡软件的Linux主机。集群下的节点均部署同样的软件和配置，互为主备，并且同一时刻只有一个主节点。负载均衡节点都运行keepalived高可用软件，keepalived检测每个节点的健康状况，确保只有一个主节点提供服务。

每个负载均衡节点内部署了开源负载均衡软件:

* haproxy：负责TCP四层负载均衡和http/https七层负责均衡
* gobetween: 负责UDP四层负载均衡转发
* keepalived: 负责主备节点的切换

## 负载均衡的配置

为了让负载均衡功能正常工作，管理员需要在平台进行相关的配置，大概分为两步：

### 第一步：部署负载均衡节点

负载均衡节点是承载负载均衡功能的实际执行者，至少需要部署1个负载均衡节点。

部署一个负载均衡节点的具体步骤请参见[安装部署](./lbagent)。

一般建议做法是新建一台单网口的经典网络虚拟机，将该虚拟机作为负载均衡节点加入集群。(注意关闭虚拟机的“源和目的地址检查”！)

建议部署2台负载均衡节点，实现主备倒换的高可用负载均衡集群。

### 第二步：配置负载均衡集群

新建负载均衡集群，并将第一步部署的负载均衡节点加入该集群。等待大约15分钟后，在节点的服务获取到集群的配置后，集群开始正常工作。

以上配置步骤完成后，即可开始负载均衡的使用。

## 创建负载均衡实例 

当负载均衡集群配置完成后，就可以使用前端 Web 界面创建负载均衡实例了。
